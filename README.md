###### Итоговая аттестация по программе «Профессия "Backend-разработчик на Go"»
# API Gateway 

Задание состояло из нескольких пунктов:
1. Разработать агрегатор новостей;
2. Разботать сервис комменатриев;
3. Разработать сервис, который получает запрос от клиента, на его основе передает запросы к агрегатору новостей, сервису комменатриев и получает от них ответ, обрабатывает его и передает назад клиенту.

### Агрегатор новостей
Агрегатор новостей был создан ранее, нужно было его немного доработать.  
[Агрегатор новостей со всеми дополнениями](https://github.com/huuno-em/news)
1. Добавить поиск по названию
2. Добавить постраничную навигацию к запросу списка новостей
3. Добавить журналирование запросов (*не указано, в каком виде нужно сделать журналирование, поэтому просто вывод лога в командную строку*)

### Сервис комментариев
[Сервис комментариев](https://github.com/huuno-em/comments)
Для сервиса комменатриев была создана отдельная база данных.
Сервис должен уметь записывать в базу данных комменатрии и извлекать их по запросу.

### Сервис цензурирования
[Сервис цензурирования](https://github.com/huuno-em/verification)
По заданию необходимо было сделать сервис цензурирования, для того, чтобы сначала комментарии проходили некторую верификацию, и только после ее прохождения добавлялись в базу данных.

# Запуск
Для начала нужно скопировать все необходимые для работы репозитории:
1. [Агрегатор новостей со всеми дополнениями](https://github.com/huuno-em/news)
2. [Сервис комментариев](https://github.com/huuno-em/comments)
3. [Сервис цензурирования](https://github.com/huuno-em/verification)
4. [APIGateway](https://github.com/huuno-em/api_gateway)

Далее идем по шагам:
1) Запускаем [Сервис цензурирования](https://github.com/huuno-em/verification)
```go
go run main.go
```
2) Переходим в [Сервис комментариев](https://github.com/huuno-em/comments). В проекте есть docker-compose, подняв который у нас будут базы данных для комментариев и для новостей:
```go
docker build -t two-db .
docker-compose up -d
```
3) После этого можно запустить сам сервис комментариев:
 ```go
go run main.go
```
5) База данных для [агрегатора новостей](https://github.com/huuno-em/news) у нас есть, разворачивать отдельный контейнер под нее не нужно, хоть он и есть в проекте. Запускаем агрегатор новостей, который сразу начнет парсить новости:
 ```go
go run server.go
```
6) Осталось только запустить сервис [APIGateway](https://github.com/huuno-em/api_gateway):
 ```go
go run main.go
```  

Порты по умолчанию:
| Сервис        | Порт  |
| ------------- |:-----:|
| APIGateway    | 8080  |
| Верификция    | 8081  |
| Комменатрии   | 8082  |
| Агрегатор     | 8083  |

Если нужно поменять порты, в APIGateway это можно сделать в файле pcg/const/const.go , но не забывайте поменять на соответствующие порты в самих сервисах.

# Тестирование

Тестировать все будем через Postman
##### Добавление комментария
Для добавления комменатрия нужно передать ID новости или ID родительского комменатрия, а так же сам текст комментария.
В Postman выбираем метод POST , запрос http://localhost:8080/create-comment, и в теле запроса нужно указать ID новости и текст комментария
 ```go
{   
    "news_id": 1,
    "commentText": "PROVERKA"
}
```
##### Извлечение комментария
В Postman выбираем метод GET , запрос http://localhost:8080/get-comment/1

##### Извлечение новостей
В Postman выбираем метод GET , запрос http://localhost:8080/news/3 выдаст нам 3 новости на страницу.
Чтобы проверить пагинацию, сделаем другой запрос http://localhost:8080/news/3/2

##### Извлечение новости и комменатриев к ней
В Postman выбираем метод GET , запрос http://localhost:8080/id/1
Так как мы добавляли комменатрий к новости с ID = 1 , в ответ мы должны получить саму новость и комменатрии к ней.
